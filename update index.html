<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>üèá K·∫øt qu·∫£ ƒëua ng·ª±a</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #fefefe;
      color: #222;
      padding: 20px;
      text-align: center;
    }
    h2, h3 {
      color: #b80000;
    }
    .input-area {
      margin-bottom: 20px;
    }
    input[type="text"] {
      width: 100px;
      height: 50px;
      font-size: 24px;
      text-align: center;
      border: 2px solid #b80000;
      border-radius: 8px;
      background-color: #fff5f5;
    }
    button {
      display: none;
    }
    table {
      border-collapse: collapse;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      font-size: 14px;
    }
    th {
      background-color: #f44336;
      color: white;
    }
    .number-cell {
      background-color: #e6f7ff;
      font-weight: bold;
    }
    .grid {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    .section {
      flex: 1;
      min-width: 280px;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <h2>üèá K·∫øt qu·∫£ ƒëua ng·ª±a</h2>
  <div class="input-area">
    <input type="text" id="nums" maxlength="3" placeholder="VD: 123" />
    <button>Th√™m l∆∞·ª£t</button>
  </div>

  <div class="grid">
    <div class="section">
      <h3>üìã L·ªãch s·ª≠ ƒëua</h3>
      <table>
        <thead>
          <tr>
            <th>L∆∞·ª£t</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>Xo√°</th>
          </tr>
        </thead>
        <tbody id="dataBody"></tbody>
      </table>
    </div>
    <div class="section">
      <h3>üìä S·ªë l·∫ßn ng·ª±a v·ªÅ top 3</h3>
      <table>
        <thead>
          <tr><th>Ng·ª±a</th><th>L∆∞·ª£t v·ªÅ top</th></tr>
        </thead>
        <tbody id="countBody"></tbody>
      </table>
    </div>
    <div class="section">
      <h3>üîÆ D·ª± ƒëo√°n: Ng·ª±a n·ªïi b·∫≠t</h3>
      <table>
        <thead>
          <tr><th>Ng·ª±a</th><th>Chu·ªói li√™n ti·∫øp</th></tr>
        </thead>
        <tbody id="predictionBody"></tbody>
      </table>
    </div>
    <div class="section">
      <h3>‚è±Ô∏è Ng·ª±a 3 l·∫ßn ch∆∞a ra</h3>
      <table>
        <thead>
          <tr><th>Ng·ª±a</th><th>S·ªë l∆∞·ª£t v·∫Øng m·∫∑t</th></tr>
        </thead>
        <tbody id="missingBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const input = document.getElementById('nums');
    let dataList = [];

    function calculateStreaks() {
      const streak = {1:0,2:0,3:0,4:0,5:0,6:0};
      // Duy·ªát ng∆∞·ª£c d·ªØ li·ªáu t·ª´ l∆∞·ª£t m·ªõi nh·∫•t v·ªÅ l∆∞·ª£t c≈©
      for (let horse = 1; horse <= 6; horse++) {
        let count = 0;
        for (let i = dataList.length - 1; i >= 0; i--) {
          if (dataList[i].includes(horse)) {
            count++;
          } else {
            break;
          }
        }
        streak[horse] = count;
      }
      return streak;
    }

    function calculateMissings() {
  const missing = {1:0,2:0,3:0,4:0,5:0,6:0};

  for (let horse = 1; horse <= 6; horse++) {
    let count = 0;
    for (let i = dataList.length - 1; i >= 0; i--) {
      if (dataList[i].includes(horse)) {
        break; // ng·ª±a xu·∫•t hi·ªán, reset ƒë·∫øm
      } else {
        count++;
      }
    }
    missing[horse] = count;
  }

  return missing;
}


    function renderTable() {
      const dataBody = document.getElementById('dataBody');
      const countBody = document.getElementById('countBody');
      const predictionBody = document.getElementById('predictionBody');
      const missingBody = document.getElementById('missingBody');

      let countMap = {1:0,2:0,3:0,4:0,5:0,6:0};
      dataBody.innerHTML = '';
      dataList.forEach((row, idx) => {
        const colors = ['#b80000', '#0077b6', '#000'];
        const cells = Array(6).fill('{}').map((_, i) => {
          const index = row.indexOf(i + 1);
          const color = index !== -1 ? colors[index] : '';
          const value = index !== -1 ? i + 1 : '';
          if (value) countMap[i + 1]++;
          return `<td class='number-cell' style="color: ${color}">${value}</td>`;
        }).join('');
        dataBody.innerHTML += `<tr>
          <td>${idx + 1}</td>${cells}
          <td><button onclick="handleDelete(${idx})" style="font-size: 10px; padding: 2px 6px">x</button></td>
        </tr>`;
      });

      countBody.innerHTML = '';
      for(let i=1; i<=6; i++) {
        countBody.innerHTML += `<tr><td>Ng·ª±a ${i}</td><td>${countMap[i]}</td></tr>`;
      }

      predictionBody.innerHTML = '';
      const streaks = calculateStreaks();
      let anyStreak = false;
      for(let i=1; i<=6; i++) {
        if(streaks[i] >= 3) {
          predictionBody.innerHTML += `<tr><td>Ng·ª±a ${i}</td><td>${streaks[i]} l·∫ßn</td></tr>`;
          anyStreak = true;
        }
      }
      if(!anyStreak) {
        predictionBody.innerHTML = `<tr><td colspan="2">Kh√¥ng c√≥ ng·ª±a n·ªïi b·∫≠t</td></tr>`;
      }

      missingBody.innerHTML = '';
      const missings = calculateMissings();
      let anyMiss = false;
      for(let i=1; i<=6; i++) {
        if(missings[i] >= 3) {
          missingBody.innerHTML += `<tr><td>Ng·ª±a ${i}</td><td>${missings[i]} l∆∞·ª£t</td></tr>`;
          anyMiss = true;
        }
      }
      if(!anyMiss) {
        missingBody.innerHTML = `<tr><td colspan="2">Kh√¥ng c√≥ ng·ª±a v·∫Øng 3 l∆∞·ª£t</td></tr>`;
      }
    }

    function handleDelete(idx) {
      dataList.splice(idx, 1);
      renderTable();
    }

    input.addEventListener('keydown', (e) => {
      if(e.key === 'Enter') {
        const val = input.value.trim();
        if(val.length !== 3) {
          alert('Vui l√≤ng nh·∫≠p ƒë√∫ng 3 s·ªë t·ª´ 1 ƒë·∫øn 6.');
          return;
        }
        if(!/^[1-6]{3}$/.test(val)) {
          alert('Ch·ªâ ƒë∆∞·ª£c nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn 6.');
          return;
        }
        const digits = val.split('');
        if(new Set(digits).size !== 3) {
          alert('Kh√¥ng ƒë∆∞·ª£c nh·∫≠p s·ªë tr√πng nhau.');
          return;
        }
        dataList.push(digits.map(Number));
        input.value = '';
        renderTable();
      }
    });

    renderTable();
  </script>
</body>
</html>
